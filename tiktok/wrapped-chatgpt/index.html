<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TikTok Wrapped - ND Labs</title>
<link rel="icon" href="/logo.png">
<style>
  :root{
    --bg:#0f1115;
    --card:#141619;
    --muted:#9aa0a6;
    --accent:#25f4ee;
    --accent2:#fe2c55;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0c0f 0%, #0f1115 60%);color:#fff}
  header{
    display:flex;align-items:center;gap:14px;padding:18px 20px;border-bottom:1px solid rgba(255,255,255,0.03);
    position:sticky;top:0;background:linear-gradient(180deg, rgba(15,17,21,0.7), rgba(15,17,21,0.4));
    backdrop-filter: blur(6px); z-index:10;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .brand img.logo{width:44px;height:44px;border-radius:10px;object-fit:cover;border:1px solid rgba(255,255,255,0.06)}
  .brand .title{line-height:1}
  .title .name{font-weight:700;letter-spacing:0.2px;font-size:18px}
  .title .sub{font-size:12px;color:var(--muted)}
  main{max-width:1100px;margin:22px auto;padding:0 18px}
  .uploader{
    display:flex;gap:12px;align-items:center;margin-bottom:18px;
  }
  .drop{
    flex:1;padding:18px;border-radius:12px;background:var(--glass);border:1px dashed rgba(255,255,255,0.04);
    display:flex;align-items:center;justify-content:center;gap:12px;cursor:pointer;min-height:70px;
  }
  input[type=file]{display:none}
  .summary{display:flex;gap:12px;margin-bottom:18px;flex-wrap:wrap}
  .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;min-width:160px;box-shadow: 0 6px 18px rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.02)}
  .stat h3{margin:0;font-size:18px}
  .stat p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .controls{margin-left:auto;display:flex;gap:8px}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;cursor:pointer;color:#fff;font-weight:600}
  .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column}
  .thumb{height:140px;display:block;background:#111;object-fit:cover}
  .meta{padding:12px;display:flex;flex-direction:column;gap:8px}
  .meta .t{font-weight:700;font-size:14px}
  .meta .info{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:13px}
  .badge{padding:6px 8px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));font-weight:700;font-size:12px;color:#000}
  footer{margin-top:40px;padding:22px 18px;display:flex;align-items:center;justify-content:center;gap:10px;color:var(--muted);border-top:1px solid rgba(255,255,255,0.02)}
  footer img{height:28px;opacity:0.95}
  .small{font-size:13px;color:var(--muted)}
  a.open{color:var(--accent);text-decoration:none;font-weight:700}
  .empty{padding:40px;border-radius:12px;text-align:center;color:var(--muted);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px dashed rgba(255,255,255,0.02)}
  @media (max-width:600px){ .brand .title .name{font-size:16px} .thumb{height:120px} }
</style>
</head>
<body>
<header>
  <div class="brand">
    <img src="/logo.png" class="logo" alt="ND Labs">
    <div class="title">
      <div class="name">TikTok Wrapped <span style="color:var(--accent);font-weight:800">- ND Labs</span></div>
      <div class="sub">Your year in short videos ‚Äî rendered from JSON</div>
    </div>
  </div>

  <div class="controls" style="margin-left:auto">
    <label class="btn" id="btnOpen">Ch·ªçn file JSON</label>
    <input id="file" type="file" accept=".json,application/json">
    <button class="btn" id="reset">Xo√°</button>
  </div>
</header>

<main>
  <div class="uploader">
    <div id="drop" class="drop">
      K√©o file JSON v√†o ƒë√¢y ho·∫∑c nh·∫•n "Ch·ªçn file JSON".<br><small class="small">H·ªó tr·ª£: m·∫£ng video ho·∫∑c { "videos":[...] } ‚Äî m·ªói video n√™n c√≥: title, views, likes, thumbnail, url, date</small>
    </div>
  </div>

  <div id="content">
    <div id="empty" class="empty">Ch∆∞a c√≥ file. T·∫£i l√™n file JSON ch·ª©a d·ªØ li·ªáu TikTok Wrapped ƒë·ªÉ xem.</div>
  </div>

  <div style="height:10px"></div>

  <footer>
    <img src="/tiktok/wrapped-chatgpt/tiktok.png" alt="TikTok logo (bottom)">
    <div class="small">Giao di·ªán l·∫•y c·∫£m h·ª©ng TikTok ‚Äî ND Labs</div>
  </footer>
</main>

<script>
  const fileInput = document.getElementById('file');
  const drop = document.getElementById('drop');
  const content = document.getElementById('content');
  const empty = document.getElementById('empty');
  const btnOpen = document.getElementById('btnOpen');
  const resetBtn = document.getElementById('reset');

  btnOpen.addEventListener('click', ()=> fileInput.click());
  resetBtn.addEventListener('click', ()=> {
    content.innerHTML = '<div id="empty" class="empty">Ch∆∞a c√≥ file. T·∫£i l√™n file JSON ch·ª©a d·ªØ li·ªáu TikTok Wrapped ƒë·ªÉ xem.</div>';
  });

  ['dragenter','dragover'].forEach(ev=>{
    drop.addEventListener(ev, e=>{ e.preventDefault(); drop.style.borderColor='rgba(255,255,255,0.12)'})
  });
  ['dragleave','drop'].forEach(ev=>{
    drop.addEventListener(ev, e=>{ e.preventDefault(); drop.style.borderColor='rgba(255,255,255,0.04)'})
  });
  drop.addEventListener('drop', e=>{
    const f = e.dataTransfer.files?.[0];
    if(f) handleFile(f);
  });

  fileInput.addEventListener('change', e=>{
    const f = e.target.files?.[0];
    if(f) handleFile(f);
  });

  function handleFile(file){
    const reader = new FileReader();
    reader.onload = ()=> {
      try{
        const json = JSON.parse(reader.result);
        renderData(normalize(json));
      }catch(err){
        alert('File kh√¥ng ph·∫£i JSON h·ª£p l·ªá.');
      }
    };
    reader.readAsText(file);
  }

  function normalize(data){
    // Allow either root array or { videos: [...] } or {items: [...]}
    if(Array.isArray(data)) return data;
    if(data.videos && Array.isArray(data.videos)) return data.videos;
    if(data.items && Array.isArray(data.items)) return data.items;
    // try to find first array value
    for(const k in data) if(Array.isArray(data[k])) return data[k];
    // fallback: try to find objects in object keys grouping by probable video props
    return Object.values(data).filter(v=>typeof v==='object');
  }

  function fmt(n){
    if (n==null) return '-';
    const num = Number(n);
    if (Number.isNaN(num)) return n;
    if (num >= 1e9) return (num/1e9).toFixed(1)+'B';
    if (num >= 1e6) return (num/1e6).toFixed(1)+'M';
    if (num >= 1e3) return (num/1e3).toFixed(1)+'K';
    return String(num);
  }

  function renderData(items){
    if(!items || items.length===0){
      content.innerHTML = '<div class="empty">JSON r·ªóng ho·∫∑c kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu video.</div>';
      return;
    }

    // map to safe objects
    const videos = items.map(it=>{
      return {
        title: it.title || it.desc || it.description || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ',
        views: Number(it.views ?? it.view ?? it.playCount ?? 0) || 0,
        likes: Number(it.likes ?? it.like ?? it.diggCount ?? 0) || 0,
        thumbnail: it.thumbnail || it.thumb || it.cover || it.image || '',
        url: it.url || it.link || (it.author && it.id ? `https://www.tiktok.com/@${it.author}/video/${it.id}` : ''),
        date: it.date || it.createdAt || it.time || ''
      };
    });

    // compute summary
    const totalViews = videos.reduce((s,v)=>s+v.views,0);
    const totalLikes = videos.reduce((s,v)=>s+v.likes,0);
    const topByViews = [...videos].sort((a,b)=>b.views-a.views).slice(0,6);

    // build html
    let html = '';
    html += `<div class="summary">
      <div class="stat"><h3>${fmt(totalViews)}</h3><p>T·ªïng l∆∞·ª£t xem</p></div>
      <div class="stat"><h3>${fmt(totalLikes)}</h3><p>T·ªïng l∆∞·ª£t th√≠ch</p></div>
      <div class="stat"><h3>${videos.length}</h3><p>S·ªë video</p></div>
      <div class="stat"><h3>${fmt(Math.round(totalViews / Math.max(1, videos.length)))}</h3><p>Trung b√¨nh views/video</p></div>
    </div>`;

    html += `<h3 style="margin:8px 0 12px">Top videos theo l∆∞·ª£t xem</h3>`;
    html += `<div class="list">`;
    topByViews.forEach((v, idx)=>{
      html += `<div class="card">
        ${v.thumbnail ? `<img class="thumb" src="${escapeHtml(v.thumbnail)}" alt="thumb">` : `<div class="thumb" style="display:flex;align-items:center;justify-content:center;color:var(--muted)">${idx+1}</div>`}
        <div class="meta">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="t">${escapeHtml(v.title)}</div>
            <div class="badge">${fmt(v.views)}</div>
          </div>
          <div class="info">
            <div>‚ù§ ${fmt(v.likes)}</div>
            <div>${v.date?escapeHtml(v.date):''}</div>
            ${v.url?`<div><a class="open" href="${escapeAttr(v.url)}" target="_blank" rel="noopener">M·ªü video</a></div>`:''}
          </div>
        </div>
      </div>`;
    });
    html += `</div>`;

    html += `<h3 style="margin:16px 0 8px">T·∫•t c·∫£ video (${videos.length})</h3>`;
    html += `<div class="list">`;
    videos.forEach(v=>{
      html += `<div class="card">
        ${v.thumbnail ? `<img class="thumb" src="${escapeHtml(v.thumbnail)}" alt="thumb">` : `<div class="thumb" style="display:flex;align-items:center;justify-content:center;color:var(--muted)">‚Äî</div>`}
        <div class="meta">
          <div class="t">${escapeHtml(v.title)}</div>
          <div class="info">
            <div>‚ù§ ${fmt(v.likes)}</div>
            <div>üëÅ ${fmt(v.views)}</div>
            ${v.url?`<div><a class="open" href="${escapeAttr(v.url)}" target="_blank" rel="noopener">M·ªü video</a></div>`:''}
          </div>
        </div>
      </div>`;
    });
    html += `</div>`;

    content.innerHTML = html;
    window.scrollTo({top:0,behavior:'smooth'});
  }

  // minimal escaping
  function escapeHtml(s){
    if(!s && s !== 0) return '';
    return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
  }
  function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;') }

</script>
<!-- ƒê·∫∑t ·ªü cu·ªëi body -->
  <div class="home-wrapper">
    <!-- N√∫t Trang Ch·ªß -->
    <a href="/index.html" class="home-btn">
      <img src="/homebtn.png" alt="Trang ch·ªß">
    </a>

    <style>
      .home-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 55px;
        height: 55px;
        background: #666666;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        cursor: pointer;
        z-index: 9999;
        animation: float 3s ease-in-out infinite;
        text-decoration: none;
      }
      .home-btn img {
        max-width: 60%;
        max-height: 60%;
        object-fit: contain;
        filter: brightness(0) invert(1);
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-6px); }
      }
      .home-btn:hover {
        transform: scale(1.05);
        transition: 0.3s;
      }
    </style>
  </div>
</body>
</html>
