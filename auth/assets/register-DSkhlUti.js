import{o as h,a as m,e as c,f as l,g as f,c as w,u as I,h as u}from"./firebase-MFGuTdBG.js";const y=document.getElementById("register-form"),D=document.getElementById("ndid"),b=document.getElementById("fullname"),N=document.getElementById("email"),E=document.getElementById("password"),s=document.getElementById("submit-btn"),i=document.createElement("div");i.className="status-msg";document.body.appendChild(i);function a(t,e){i.textContent=t,i.className=`status-msg show ${e}`,setTimeout(()=>{i.className="status-msg"},4e3)}h(m,t=>{t&&t.displayName&&(window.location.href="/")});y.addEventListener("submit",async t=>{t.preventDefault();const e=D.value.trim().toLowerCase(),d=b.value.trim(),r=N.value.trim(),p=E.value;if(e.length<3)return a("NDID phải từ 3 ký tự trở lên.","error");if(!/^[a-z0-9_]+$/.test(e))return a("NDID chỉ gồm chữ cái, số và dấu gạch dưới.","error");s.disabled=!0,s.innerHTML="<span>Đang khởi tạo NDID...</span>";try{const n=c(l,"ndids",e);if((await f(n)).exists()){a("NDID này đã có người sử dụng. Vui lòng chọn cái khác.","error"),s.disabled=!1,s.innerHTML='<span>Tạo tài khoản</span><i class="ph-bold ph-user-plus"></i>';return}const g=`${e}@ndlabs.local`,o=(await w(m,g,p)).user;await I(o,{displayName:d}),await u(c(l,"ndids",e),{uid:o.uid,primaryEmail:r}),await u(c(l,"users",o.uid),{ndid:e,fullname:d,emails:[r],createdAt:new Date().toISOString(),xp:0}),localStorage.setItem("nd_user",JSON.stringify({displayName:d,email:r,uid:o.uid,ndid:e})),a("NDID của bạn đã được tạo thành công!","success"),setTimeout(()=>{window.location.href="/"},1200)}catch(n){console.error(n),a("Lỗi: "+(n.code||n.message),"error"),s.disabled=!1,s.innerHTML='<span>Tạo tài khoản</span><i class="ph-bold ph-user-plus"></i>'}});
