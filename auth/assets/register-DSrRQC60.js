import{o as f,a as u,d as c,c as l,g as h,e as w,u as I,f as m}from"./firebase-DLphYnwd.js";const y=document.getElementById("register-form"),D=document.getElementById("ndid"),E=document.getElementById("fullname"),N=document.getElementById("email"),b=document.getElementById("password"),n=document.getElementById("submit-btn"),a=document.createElement("div");a.className="status-msg";document.body.appendChild(a);function i(t,e){a.textContent=t,a.className=`status-msg show ${e}`,setTimeout(()=>{a.className="status-msg"},4e3)}f(u,t=>{t&&t.displayName&&(window.location.href="/")});y.addEventListener("submit",async t=>{t.preventDefault();const e=D.value.trim().toLowerCase(),d=E.value.trim(),r=N.value.trim(),g=b.value;if(e.length<3)return i("NDID phải từ 3 ký tự trở lên.","error");n.disabled=!0,n.innerHTML="<span>Đang khởi tạo NDID...</span>";try{const s=c(l,"ndids",e);if((await h(s)).exists()){i("NDID này đã có người sử dụng.","error"),n.disabled=!1,n.innerHTML="<span>Tạo tài khoản</span>";return}const p=`${e}@ndlabs.com`,o=(await w(u,p,g)).user;await I(o,{displayName:d}),await m(c(l,"ndids",e),{uid:o.uid,recoveryEmail:r}),await m(c(l,"users",o.uid),{ndid:e,fullname:d,emails:[r],createdAt:new Date().toISOString()}),localStorage.setItem("nd_user",JSON.stringify({displayName:d,email:r,uid:o.uid,ndid:e})),i("Tạo NDID thành công!","success"),setTimeout(()=>{window.location.href="/"},1200)}catch(s){console.error(s),i("Lỗi: "+(s.code||s.message),"error"),n.disabled=!1,n.innerHTML="<span>Tạo tài khoản</span>"}});
