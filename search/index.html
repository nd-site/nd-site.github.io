<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√¨m ki·∫øm - ND Labs</title>
    <link rel="icon" href="/logo.png" type="image/png">
    <style>
        :root {
            --blue-main: #00a8ff;
            --blue-dark: #0077ff;
            --bg: #f8fbff;
            --white: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        header { background: var(--white); padding: 15px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .brand { display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .brand img { height: 40px; }
        .brand span { font-size: 1.5rem; font-weight: 800; color: var(--blue-dark); }

        .container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
        .search-wrapper { position: relative; margin-bottom: 20px; }
        input { width: 100%; padding: 16px 25px; border-radius: 50px; border: 2px solid var(--blue-main); outline: none; font-size: 17px; box-shadow: 0 8px 20px rgba(0,168,255,0.1); transition: 0.3s; }
        input:focus { box-shadow: 0 8px 25px rgba(0,168,255,0.25); }
        
        #status { font-size: 0.85rem; text-align: center; color: var(--blue-dark); margin-bottom: 15px; min-height: 20px; }

        .result-item { background: var(--white); padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 6px solid var(--blue-main); transition: 0.3s; position: relative; text-decoration: none; display: block; overflow: hidden; }
        .result-item:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        
        .title { color: var(--blue-dark); font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; padding-right: 60px; }
        .snippet { color: #666; font-size: 0.9rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .badge { position: absolute; top: 20px; right: 20px; font-size: 0.65rem; font-weight: bold; padding: 4px 10px; border-radius: 4px; letter-spacing: 1px; }
        .badge-site { background: #e3f2fd; color: #1976d2; border: 1px solid #1976d2; }
        .badge-web { background: #fff3e0; color: #f57c00; border: 1px solid #f57c00; }

        .no-results { text-align: center; padding: 40px; color: #999; }
    </style>
</head>
<body>

<header>
    <a href="/" class="brand">
        <img src="/logo.png" alt="ND Labs" onerror="this.style.display='none'">
        <span>ND Labs</span>
    </a>
</header>

<div class="container">
    <div id="status">ƒêang kh·ªüi t·∫°o h·ªá th·ªëng...</div>
    <div class="search-wrapper">
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm file, b√†i vi·∫øt ho·∫∑c n·ªôi dung..." disabled>
    </div>
    <div id="resultsList"></div>
</div>

<script>
    // --- C·∫§U H√åNH ƒêA REPO ---
    const CONFIG = {
        username: 'nd-site',
        // Danh s√°ch c√°c Repo b·∫°n mu·ªën qu√©t d·ªØ li·ªáu
        repositories: [
            'nd-site.github.io', 
            'test', 
            'windows12',
            'eduspace',
            'hoctap',
            '-'
            // B·∫°n c√≥ th·ªÉ th√™m bao nhi√™u repo t√πy th√≠ch v√†o ƒë√¢y
        ],
        branch: 'main'
    };

    const searchInput = document.getElementById('searchInput');
    const resultsList = document.getElementById('resultsList');
    const status = document.getElementById('status');
    let searchDatabase = [];

    // 1. H√†m l·∫•y file t·ª´ M·ªòT repo c·ª• th·ªÉ
    async function getFilesFromRepo(repoName) {
        try {
            const treeUrl = `https://api.github.com/repos/${CONFIG.username}/${repoName}/git/trees/${CONFIG.branch}?recursive=1`;
            const response = await fetch(treeUrl);
            if (!response.ok) return [];
            
            const data = await response.json();
            return data.tree
                .filter(file => file.path.endsWith('.html') && file.path !== 'search.html')
                .map(file => {
                    // X√¢y d·ª±ng URL d·∫´n ƒë·∫øn trang web t∆∞∆°ng ·ª©ng
                    // N·∫øu l√† repo ch√≠nh (username.github.io) th√¨ path l√† /, n·∫øu repo kh√°c th√¨ path l√† /repo/
                    const baseUrl = repoName === `${CONFIG.username}.github.io` 
                                    ? `https://${CONFIG.username}.github.io/` 
                                    : `https://${CONFIG.username}.github.io/${repoName}/`;
                    return baseUrl + file.path.replace('index.html', '');
                });
        } catch (e) {
            console.error(`L·ªói qu√©t repo ${repoName}:`, e);
            return [];
        }
    }

    // 2. H√†m ƒë·ªçc n·ªôi dung (Crawl) n·ªôi dung file
    async function crawlPage(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) return null;
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            doc.querySelectorAll('script, style, nav, footer').forEach(el => el.remove());

            const title = doc.querySelector('h1')?.innerText || doc.querySelector('title')?.innerText || url;
            const content = doc.body.innerText.replace(/\s+/g, ' ').trim();
            
            return {
                title: title.trim(),
                url: url,
                snippet: content.substring(0, 160) + '...',
                fullText: (title + " " + content).toLowerCase()
            };
        } catch (e) { return null; }
    }

    // 3. Kh·ªüi ch·∫°y: Qu√©t t·∫•t c·∫£ repo trong danh s√°ch
    async function init() {
        status.innerText = "üöÄ ƒêang qu√©t d·ªØ li·ªáu t·ª´ c√°c h·ªá th·ªëng ND Labs...";
        
        let allFilePaths = [];
        
        // Qu√©t l·∫ßn l∆∞·ª£t t·ª´ng Repo
        for (const repo of CONFIG.repositories) {
            const paths = await getFilesFromRepo(repo);
            allFilePaths = allFilePaths.concat(paths);
        }

        if (allFilePaths.length === 0) {
            status.innerText = "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu HTML n√†o.";
            return;
        }

        status.innerText = `üìÑ ƒêang l·∫≠p ch·ªâ m·ª•c ${allFilePaths.length} trang t·ª´ ${CONFIG.repositories.length} d·ª± √°n...`;
        
        // ƒê·ªçc n·ªôi dung t·∫•t c·∫£ file ƒë√£ t√¨m th·∫•y
        const promises = allFilePaths.map(path => crawlPage(path));
        const results = await Promise.all(promises);
        
        searchDatabase = results.filter(item => item !== null);
        
        status.innerText = `‚úÖ ƒê√£ s·∫µn s√†ng! T√¨m th·∫•y n·ªôi dung trong ${searchDatabase.length} trang.`;
        searchInput.disabled = false;
        searchInput.focus();
        setTimeout(() => status.style.opacity = '0.5', 3000);
    }

    // 4. X·ª≠ l√Ω t√¨m ki·∫øm (Gi·ªØ nguy√™n logic c≈©)
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        resultsList.innerHTML = '';
        if (query.length < 1) return;

        const matches = searchDatabase.filter(item => item.fullText.includes(query));
        matches.forEach(item => renderCard(item.title, item.url, item.snippet, 'site'));

        const googleUrl = `https://www.google.com/search?q=site:${CONFIG.username}.github.io+${encodeURIComponent(query)}`;
        renderCard(`T√¨m "${query}" tr√™n to√†n h·ªá th·ªëng (Google)`, googleUrl, `M·ªü r·ªông t√¨m ki·∫øm ra c√°c trang ch∆∞a ƒë∆∞·ª£c l·∫≠p ch·ªâ m·ª•c c·ª•c b·ªô.`, 'web');
    });

    function renderCard(title, url, desc, type) {
        const a = document.createElement('a');
        a.className = 'result-item';
        a.href = url;
        if(type === 'web') a.target = "_blank";
        
        const badgeClass = type === 'site' ? 'badge-site' : 'badge-web';
        const badgeText = type === 'site' ? 'SITE' : 'WEB';

        a.innerHTML = `
            <span class="badge ${badgeClass}">${badgeText}</span>
            <div class="title">${title}</div>
            <div class="snippet">${desc}</div>
        `;
        resultsList.appendChild(a);
    }

    init();
</script>
</body>
</html>
