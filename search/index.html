<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√¨m ki·∫øm - ND Labs</title>
    <link rel="icon" href="/logo.png" type="image/png">
    <style>
        :root {
            --blue-main: #00a8ff;
            --blue-dark: #0077ff;
            --bg: #f8fbff;
            --white: #ffffff;
            --url-color: #008a00;
        }

        /* T·ªëi ∆∞u h√≥a to√†n b·ªô trang */
        * { box-sizing: border-box; } 

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            color: #333; 
            overflow-x: hidden; /* Ch·ªëng cu·ªôn ngang tuy·ªát ƒë·ªëi */
        }
        
        /* 1. Ghim Header */
        header { 
            background: var(--white); 
            padding: 15px; 
            text-align: center; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
        }
        .brand { display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .brand img { height: 40px; }
        .brand span { font-size: 1.5rem; font-weight: 800; color: var(--blue-dark); }

        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 0 15px; /* T·∫°o kho·∫£ng c√°ch an to√†n 2 b√™n m√©p m√†n h√¨nh */
        }

        /* 2. Ghim thanh t√¨m ki·∫øm ngay d∆∞·ªõi Header */
        .search-sticky-container {
            position: sticky;
            top: 70px; /* N·∫±m ngay d∆∞·ªõi ƒë·ªô cao c·ªßa header */
            background: var(--bg);
            padding: 15px 0;
            z-index: 999;
            margin-bottom: 10px;
        }
        
        #status { 
            font-size: 0.85rem; 
            text-align: center; 
            color: var(--blue-dark); 
            margin-bottom: 10px; 
            min-height: 20px; 
        }

        .search-wrapper { position: relative; width: 100%; }
        
        /* S·ª≠a l·ªói tr√†n vi·ªÅn t·∫°i ƒë√¢y */
        input { 
            width: 100%; 
            padding: 14px 25px; 
            border-radius: 50px; 
            border: 2px solid var(--blue-main); 
            outline: none; 
            font-size: 16px; 
            box-shadow: 0 8px 20px rgba(0,168,255,0.1); 
            transition: 0.3s;
            display: block;
        }
        input:focus { box-shadow: 0 8px 25px rgba(0,168,255,0.25); border-color: var(--blue-dark); }

        /* K·∫øt qu·∫£ t√¨m ki·∫øm */
        #resultsList { padding-bottom: 30px; }

        .result-item { 
            background: var(--white); 
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 15px; 
            border-left: 6px solid var(--blue-main); 
            transition: 0.3s; 
            position: relative; 
            text-decoration: none; 
            display: block; 
            overflow: hidden; 
        }
        .result-item:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        
        .title { color: var(--blue-dark); font-weight: bold; font-size: 1.1rem; margin-bottom: 2px; padding-right: 60px; line-height: 1.3; }
        .url-display { color: var(--url-color); font-size: 0.75rem; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
        .snippet { color: #666; font-size: 0.85rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; }
        
        .badge { position: absolute; top: 15px; right: 15px; font-size: 0.6rem; font-weight: bold; padding: 3px 8px; border-radius: 4px; letter-spacing: 1px; }
        .badge-site { background: #e3f2fd; color: #1976d2; border: 1px solid #1976d2; }
        .badge-web { background: #fff3e0; color: #f57c00; border: 1px solid #f57c00; }

        /* T·ªëi ∆∞u Mobile */
        @media (max-width: 600px) {
            header { padding: 10px; }
            .brand img { height: 32px; }
            .brand span { font-size: 1.2rem; }
            .search-sticky-container { top: 52px; padding: 10px 0; }
            input { padding: 12px 20px; font-size: 15px; }
            .result-item { padding: 15px; }
            .title { font-size: 1rem; }
        }
    </style>
</head>
<body>

<header>
    <a href="/" class="brand">
        <img src="/logo.png" alt="ND Labs" onerror="this.style.display='none'">
        <span>ND Labs</span>
    </a>
</header>

<div class="container">
    <div class="search-sticky-container">
        <div id="status">ƒêang kh·ªüi t·∫°o h·ªá th·ªëng...</div>
        <div class="search-wrapper">
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm file, b√†i vi·∫øt ho·∫∑c n·ªôi dung..." disabled>
        </div>
    </div>
    
    <div id="resultsList"></div>
</div>

<script>
    const CONFIG = {
        username: 'nd-site',
        repositories: ['nd-site.github.io', 'test', 'windows12', 'eduspace', 'hoctap'],
        branch: 'main'
    };

    const searchInput = document.getElementById('searchInput');
    const resultsList = document.getElementById('resultsList');
    const status = document.getElementById('status');
    let searchDatabase = [];

    async function getFilesFromRepo(repoName) {
        try {
            const treeUrl = `https://api.github.com/repos/${CONFIG.username}/${repoName}/git/trees/${CONFIG.branch}?recursive=1`;
            const response = await fetch(treeUrl);
            if (!response.ok) return [];
            const data = await response.json();
            return data.tree
                .filter(file => file.path.endsWith('.html') && file.path !== 'search.html')
                .map(file => {
                    const baseUrl = repoName === `${CONFIG.username}.github.io` 
                                    ? `https://${CONFIG.username}.github.io/` 
                                    : `https://${CONFIG.username}.github.io/${repoName}/`;
                    return baseUrl + file.path.replace('index.html', '');
                });
        } catch (e) { return []; }
    }

    async function crawlPage(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) return null;
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            doc.querySelectorAll('script, style, nav, footer').forEach(el => el.remove());
            const title = doc.querySelector('h1')?.innerText || doc.querySelector('title')?.innerText || url;
            const content = doc.body.innerText.replace(/\s+/g, ' ').trim();
            return {
                title: title.trim(),
                url: url,
                snippet: content.substring(0, 160) + '...',
                fullText: (title + " " + content).toLowerCase()
            };
        } catch (e) { return null; }
    }

    async function init() {
        status.innerText = "üöÄ ƒêang qu√©t d·ªØ li·ªáu ND Labs...";
        let allFilePaths = [];
        for (const repo of CONFIG.repositories) {
            const paths = await getFilesFromRepo(repo);
            allFilePaths = allFilePaths.concat(paths);
        }
        if (allFilePaths.length === 0) {
            status.innerText = "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.";
            return;
        }
        status.innerText = `üìÑ ƒêang l·∫≠p ch·ªâ m·ª•c ${allFilePaths.length} trang...`;
        const promises = allFilePaths.map(path => crawlPage(path));
        const results = await Promise.all(promises);
        searchDatabase = results.filter(item => item !== null);
        status.innerHTML = `‚úÖ S·∫µn s√†ng! T√¨m th·∫•y <b>${searchDatabase.length}</b> n·ªôi dung.`;
        searchInput.disabled = false;
        searchInput.focus();
        setTimeout(() => { status.style.opacity = '0.6'; }, 3000);
    }

    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        resultsList.innerHTML = '';
        if (query.length < 1) return;
        const matches = searchDatabase.filter(item => item.fullText.includes(query));
        matches.forEach(item => renderCard(item.title, item.url, item.snippet, 'site'));
        const googleUrl = `https://www.google.com/search?q=site:${CONFIG.username}.github.io+${encodeURIComponent(query)}`;
        renderCard(`T√¨m "${query}" tr√™n Google`, googleUrl, `M·ªü r·ªông t√¨m ki·∫øm ra to√†n b·ªô h·ªá th·ªëng web.`, 'web');
    });

    function renderCard(title, url, desc, type) {
        const a = document.createElement('a');
        a.className = 'result-item';
        a.href = url;
        if(type === 'web') a.target = "_blank";
        const badgeClass = type === 'site' ? 'badge-site' : 'badge-web';
        const badgeText = type === 'site' ? 'SITE' : 'WEB';
        const displayUrl = url.replace('https://', '').replace('http://', '');
        a.innerHTML = `
            <span class="badge ${badgeClass}">${badgeText}</span>
            <div class="title">${title}</div>
            <span class="url-display">${displayUrl}</span>
            <div class="snippet">${desc}</div>
        `;
        resultsList.appendChild(a);
    }
    init();
</script>
</body>
</html>
