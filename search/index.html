<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√¨m ki·∫øm - ND Labs</title>
    <link rel="icon" href="/logo.png" type="image/png">
    <style>
        :root {
            --blue-main: #00a8ff;
            --blue-dark: #0077ff;
            --bg: #f8fbff;
            --white: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        header { background: var(--white); padding: 15px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .brand { display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .brand img { height: 40px; }
        .brand span { font-size: 1.5rem; font-weight: 800; color: var(--blue-dark); }

        .container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
        .search-wrapper { position: relative; margin-bottom: 20px; }
        input { width: 100%; padding: 16px 25px; border-radius: 50px; border: 2px solid var(--blue-main); outline: none; font-size: 17px; box-shadow: 0 8px 20px rgba(0,168,255,0.1); transition: 0.3s; }
        input:focus { box-shadow: 0 8px 25px rgba(0,168,255,0.25); }
        
        #status { font-size: 0.85rem; text-align: center; color: var(--blue-dark); margin-bottom: 15px; min-height: 20px; }

        .result-item { background: var(--white); padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 6px solid var(--blue-main); transition: 0.3s; position: relative; text-decoration: none; display: block; overflow: hidden; }
        .result-item:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        
        .title { color: var(--blue-dark); font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; padding-right: 60px; }
        .snippet { color: #666; font-size: 0.9rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .badge { position: absolute; top: 20px; right: 20px; font-size: 0.65rem; font-weight: bold; padding: 4px 10px; border-radius: 4px; letter-spacing: 1px; }
        .badge-site { background: #e3f2fd; color: #1976d2; border: 1px solid #1976d2; }
        .badge-web { background: #fff3e0; color: #f57c00; border: 1px solid #f57c00; }

        .no-results { text-align: center; padding: 40px; color: #999; }
    </style>
</head>
<body>

<header>
    <a href="/" class="brand">
        <img src="/logo.png" alt="ND Labs" onerror="this.style.display='none'">
        <span>ND Labs</span>
    </a>
</header>

<div class="container">
    <div id="status">ƒêang kh·ªüi t·∫°o h·ªá th·ªëng...</div>
    <div class="search-wrapper">
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm file, b√†i vi·∫øt ho·∫∑c n·ªôi dung..." disabled>
    </div>
    <div id="resultsList"></div>
</div>

<script>
    // --- C·∫§U H√åNH ---
    const CONFIG = {
        username: 'nd-site',
        repo: 'nd-site.github.io', // Thay b·∫±ng t√™n Repository ch·ª©a trang web c·ªßa b·∫°n
        branch: 'main' // Th∆∞·ªùng l√† main ho·∫∑c master
    };

    const searchInput = document.getElementById('searchInput');
    const resultsList = document.getElementById('resultsList');
    const status = document.getElementById('status');
    let searchDatabase = [];

    // 1. T·ª± ƒë·ªông qu√©t to√†n b·ªô file trong Repo b·∫±ng GitHub API (Recursive Tree)
    async function getAllHtmlFiles() {
        status.innerText = "üîç ƒêang qu√©t danh s√°ch file tr√™n h·ªá th·ªëng...";
        try {
            const treeUrl = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/git/trees/${CONFIG.branch}?recursive=1`;
            const response = await fetch(treeUrl);
            const data = await response.json();
            
            // Ch·ªâ l·∫•y c√°c file k·∫øt th√∫c b·∫±ng .html v√† kh√¥ng ph·∫£i l√† ch√≠nh trang search.html
            return data.tree
                .filter(file => file.path.endsWith('.html') && file.path !== 'search.html')
                .map(file => '/' + file.path.replace('index.html', ''));
        } catch (e) {
            status.innerText = "‚ö†Ô∏è L·ªói khi k·∫øt n·ªëi GitHub API.";
            return [];
        }
    }

    // 2. ƒê·ªçc n·ªôi dung t·ª´ng file
    async function crawlPage(url) {
        try {
            const response = await fetch(url);
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Lo·∫°i b·ªè c√°c ph·∫ßn kh√¥ng c·∫ßn thi·∫øt khi t√¨m n·ªôi dung
            doc.querySelectorAll('script, style, nav, footer').forEach(el => el.remove());

            const title = doc.querySelector('h1')?.innerText || doc.querySelector('title')?.innerText || url;
            const content = doc.body.innerText.replace(/\s+/g, ' ').trim();
            
            return {
                title: title.trim(),
                url: url,
                snippet: content.substring(0, 160) + '...',
                fullText: (title + " " + content).toLowerCase()
            };
        } catch (e) { return null; }
    }

    // 3. Kh·ªüi ch·∫°y h·ªá th·ªëng
    async function init() {
        const filePaths = await getAllHtmlFiles();
        if (filePaths.length === 0) {
            status.innerText = "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.";
            return;
        }

        status.innerText = `üìÑ ƒêang l·∫≠p ch·ªâ m·ª•c ${filePaths.length} trang...`;
        
        const promises = filePaths.map(path => crawlPage(path));
        const results = await Promise.all(promises);
        
        searchDatabase = results.filter(item => item !== null);
        
        status.innerText = `‚úÖ ƒê√£ s·∫µn s√†ng t√¨m ki·∫øm tr√™n to√†n b·ªô Website!`;
        searchInput.disabled = false;
        searchInput.focus();
        setTimeout(() => status.style.opacity = '0.5', 3000);
    }

    // 4. X·ª≠ l√Ω t√¨m ki·∫øm
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        resultsList.innerHTML = '';

        if (query.length < 1) return;

        // T√¨m trong Site
        const matches = searchDatabase.filter(item => item.fullText.includes(query));

        matches.forEach(item => {
            renderCard(item.title, item.url, item.snippet, 'site');
        });

        // Lu√¥n ƒë·ªÅ xu·∫•t Google (Web)
        const googleUrl = `https://www.google.com/search?q=site:${CONFIG.username}.github.io+${encodeURIComponent(query)}`;
        renderCard(`T√¨m "${query}" m·ªü r·ªông qua Google`, googleUrl, `N·∫øu kh√¥ng th·∫•y k·∫øt qu·∫£ ∆∞ng √Ω, h√£y th·ª≠ t√¨m ki·∫øm to√†n di·ªán h∆°n v·ªõi Google Search.`, 'web');
    });

    function renderCard(title, url, desc, type) {
        const a = document.createElement('a');
        a.className = 'result-item';
        a.href = url;
        if(type === 'web') a.target = "_blank";
        
        const badgeClass = type === 'site' ? 'badge-site' : 'badge-web';
        const badgeText = type === 'site' ? 'SITE' : 'WEB';

        a.innerHTML = `
            <span class="badge ${badgeClass}">${badgeText}</span>
            <div class="title">${title}</div>
            <div class="snippet">${desc}</div>
        `;
        resultsList.appendChild(a);
    }

    init();
</script>

</body>
</html>
