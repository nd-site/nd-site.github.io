<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Đồng hồ đếm giờ</title>
<style>
  /* Reset cơ bản */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  /* Giao diện chung */
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #e9eff5; /* Nền xanh nhạt hiện đại */
    color: #333;
  }

  /* Container chính */
  .timer-container {
    background: #ffffff;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
    min-width: 400px;
  }

  /* Khung hiển thị giờ */
  .timer-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    gap: 10px;
  }

  /* Label */
  label {
    font-weight: 600;
    font-size: 1rem;
    color: #555;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Số hiển thị */
  .display {
    font-size: 4rem; /* Kích thước phù hợp cho SS.mmm */
    font-weight: 700;
    color: #1e88e5; /* Màu xanh nổi bật */
    padding: 10px 20px;
    border-radius: 8px;
    background: #f4f7fa;
    width: 100%;
    text-align: center;
    font-variant-numeric: tabular-nums;
  }
  
  /* Số đếm ngược (đặc biệt) */
  #down {
      color: #e53935; /* Màu đỏ cho đếm ngược */
  }

  /* Input đếm ngược */
  #countdownInput {
    width: 100px;
    padding: 8px 10px;
    font-size: 1.1rem;
    text-align: center;
    border: 2px solid #ccc;
    border-radius: 5px;
    outline: none;
    transition: border-color 0.3s;
  }
  
  #countdownInput:focus {
    border-color: #1e88e5;
  }

  /* Khung controls */
  .controls {
    display: flex;
    gap: 15px;
    margin-top: 10px;
  }

  /* Nút bấm */
  button {
    padding: 12px 25px;
    font-size: 1.1rem;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.1s;
    text-transform: uppercase;
  }

  /* Nút Bắt đầu/Dừng/Tiếp tục */
  #startStop {
    background-color: #4CAF50; /* Xanh lá */
    color: white;
  }

  #startStop:hover {
    background-color: #43a047;
    transform: translateY(-2px);
  }
  
  /* Nút Reset */
  #reset {
    background-color: #f44336; /* Đỏ */
    color: white;
  }
  
  #reset:hover {
    background-color: #e53935;
    transform: translateY(-2px);
  }
  
  /* Điều chỉnh bố cục cho đếm ngược */
  .countdown-setup {
    display: flex;
    align-items: center;
    gap: 15px;
    width: 100%;
    justify-content: center;
  }
  
  .countdown-setup > label {
    margin-right: auto;
  }
  
  .countdown-setup .display {
    width: auto;
    flex-grow: 1;
  }

</style>
</head>
<body>
<div class="timer-container">
  <h2>⏲️ Đồng Hồ Đếm Giờ</h2>
  
  <div class="timer-box">
    <label>Đếm Xuôi (Stopwatch):</label>
    <span id="up" class="display">00.000</span>
  </div>
  
  <div class="timer-box">
    <label>Đếm Ngược (Timer):</label>
    <div class="countdown-setup">
      <input type="number" id="countdownInput" placeholder="giây" min="0" value="180">
      <span id="down" class="display">180.000</span>
    </div>
  </div>
  
  <div class="controls">
    <button id="startStop">BẮT ĐẦU</button>
    <button id="reset">RESET</button>
  </div>
</div>

<script>
let upStart = 0;       // mili giây đếm xuôi
let downDuration = 0;  // mili giây tổng cho đếm ngược
let downCurrent = 0;   // mili giây hiện tại của đếm ngược
let interval = null;
let running = false;

const upDisplay = document.getElementById('up');
const downDisplay = document.getElementById('down');
const countdownInput = document.getElementById('countdownInput');
const startStopBtn = document.getElementById('startStop');
const resetBtn = document.getElementById('reset');

// Giá trị mặc định ban đầu cho input (Đã chỉnh thành 180 giây)
countdownInput.value = '180'; 

/**
 * Định dạng thời gian từ mili giây sang chuỗi SS.mmm
 * Tuyệt đối không có phút.
 */
function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const milliseconds = ms % 1000;
  
  // Định dạng SS.mmm
  return `${totalSeconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0')}`;
}

function updateDisplay() {
  upDisplay.textContent = formatTime(upStart);
  downDisplay.textContent = formatTime(Math.max(0, downCurrent));
}

function tick() {
  // Đếm xuôi
  upStart += 10;
  
  // Đếm ngược
  if (downCurrent > 0) {
    downCurrent -= 10;
    if (downCurrent <= 0) {
      downCurrent = 0;
      clearInterval(interval);
      running = false;
      startStopBtn.textContent = 'BẮT ĐẦU';
      alert('Hết giờ!'); // Thông báo khi đếm ngược kết thúc
    }
  }
  
  updateDisplay();
}

function initializeDownTimer() {
    // Chỉ đọc giá trị input khi bấm Start lần đầu hoặc Reset
    const inputSeconds = parseInt(countdownInput.value);
    downDuration = inputSeconds > 0 ? inputSeconds * 1000 : 0;
    downCurrent = downDuration;
    // Cập nhật hiển thị ngay lập tức với giá trị mới
    updateDisplay();
}

// Khởi tạo giá trị đếm ngược ban đầu
initializeDownTimer();


startStopBtn.addEventListener('click', () => {
  if (!running) {
    // Khởi tạo thời gian đếm ngược chỉ khi đồng hồ đếm xuôi đang ở 0 
    // và có giá trị trong input.
    if (upStart === 0 && parseInt(countdownInput.value) > 0) {
      initializeDownTimer();
    } 
    
    // Nếu cả 2 đều bằng 0, chỉ cần bắt đầu
    if (upStart > 0 || downCurrent > 0) {
        interval = setInterval(tick, 10);
        running = true;
        startStopBtn.textContent = 'DỪNG';
    } else if (parseInt(countdownInput.value) > 0) {
        // Trường hợp người dùng nhập giá trị và bấm start ngay
        initializeDownTimer();
        interval = setInterval(tick, 10);
        running = true;
        startStopBtn.textContent = 'DỪNG';
    } else {
        // Trường hợp không có giá trị nào để chạy
        alert("Vui lòng nhập số giây đếm ngược!");
    }
    
  } else {
    clearInterval(interval);
    running = false;
    startStopBtn.textContent = 'TIẾP TỤC';
  }
});

resetBtn.addEventListener('click', () => {
  clearInterval(interval);
  running = false;
  upStart = 0;
  
  // Cập nhật lại giá trị đếm ngược từ input
  initializeDownTimer(); 
  
  updateDisplay();
  startStopBtn.textContent = 'BẮT ĐẦU';
});

// Cập nhật lại hiển thị đếm ngược khi người dùng thay đổi input
countdownInput.addEventListener('change', () => {
    // Chỉ cập nhật khi đồng hồ đang dừng hoặc đã reset
    if (!running) {
        initializeDownTimer();
    }
});

</script>
</body>
</html>
